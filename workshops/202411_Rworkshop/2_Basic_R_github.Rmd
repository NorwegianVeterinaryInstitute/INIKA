---
title: "`r params$title`"
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: Eve Zeyl Fiskebeck
params:
  title: "2. Basic R and github with Rstudio" 
  project_path: "`r here::here()`"
output: 
  
  rmdformats::readthedown:
      css: style.css
      self_contained: true
      code_download: true
      toc_depth: 4
      df_print: paged
      code_folding: hide
      author: params$author
      highlight: espresso

  
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
library(here)
library(DiagrammeR)
```

# Basic startup

## Create/Open a project in Rstudio

Starting point: - after cloning a github repository

External resource: see also  [Project Management with RStudio](https://swcarpentry.github.io/r-novice-gapminder/02-project-intro.html)

1.  Open Rstudio
2.  Browse to the directory where you cloned the git repository:

-   create : `File -> New Project -> Existing Directory`
-   open : `File -> Open Project -> file with extension .Rproj`

... 
## EVE ADD

## Git usage in Rstudio :

workflow github with R:

```{r}
DiagrammeR::mermaid(
  "graph TB
      A[Working directory] --git add--> B[Staging area: preparation]
      B --git commit --> C[Local Repository : git directory on PC] 
      C --push --> D[Remote Repository : github]
      D --pull --> A
  ")
```

In Git window in R studio : The status (`git status`) allows you to
check if files have been modified, if they are under-version control
(tracked) or not.

Stating the files = preparing the files for saving (one or several
files) - When ? often - What ? a logical block of work eg. creating a
graph OR fixing a bug.\
- how: you select the file(s) to stage and then you can commit.

Write a commit message that explain your logical point

Then Push: - sends the changes to online repository (github)

If you work on different computer, or with different people, or need to
recover your files, you might need to pull changes - Pull take the
changes from online repository (github) and put them in the local
repository. <!-- we wont explain this specifically for now -->

## Exercise: modify `.gitignore` and push the changes to github

<!-- This allows us to make the configuration of things we do not want to track -->

<!-- use the checkbooxes when is done ! -->

-   [ ]  Verify that those lines are present in the .gitignore file, if
    not, add them

``` text
**/.*xlsx
**/data
**/results
**.Rprofile
**.Rhistory
**.Rproj
**.sqlite
```

-   [ ]  add .gitignore to the staging area
-   [ ]  commit the changes with a commit message
-   [ ]  push the changes to github
-   [ ]  verify in your github account that the changes are have been
    recorded

You will now be able to version control your code code and notes. If you
do not want a file to be tracked, you need to add its path (relative to
the path in the git repository) to the .gitigore file.

## Using a notebook in Rstudio

A Notebook (Rmarkdown) is a way to write code and notes in the same
document.
<!-- R markdown for code and notes (what is what) -->

-   [ ]  Open a new Rmarkdown document: `File -> New File -> Rmarkdown`
-   [ ]  fill tile information, keep as html
-   [ ]  save this file (or your project) your current R project directory
-   [ ]  Read what the text in the document is

![<u>Fig: Anatomy of a R markdown
document</u>](https://nkaza.github.io/intro2Rbook/images/rm_components.png)

</br>

Here is a [markdown formating cheatsheet](https://www.markdownguide.org/cheat-sheet/)
This will allow you to take notes and make them look nice (I wrote this document 
in Markdown)

-   [ ]   Take notes in your document of what the different parts of a
    Rmarkdown file are doing (ask us to repeat as many times as
    necessary and help if you do not know where to start with)

-   [ ]  Experience with Source vs Visual mode on top of your markdown document 
-   [ ]  Experience with some markdown formatting 
-   [ ]  write the code bellow in a code chunk (cell) and and run it (green arrow)
<!-- Explain code -->
-   [ ]  Knit the document to see how it can create a document from your notes

## EVE : to test if html is ok or needs doc

```{r first object, echo=TRUE, eval=FALSE, class.source = "fold-show"}
my_message <- "Hello World"
print(my_message)
```

<!-- Some other way with code --> 
Small exercises of code to try (unhide): 

```{r  echo=TRUE, eval=FALSE}
my_message
typeof(my_message)
str(my_message)
```

- [ ]  Run one line of code at in a cell (`ctrl+Enter` cursor at the end of the line)
- [ ]  Check what does my_message object contains
- [ ]  Check the type of my_message  what is its abbreviation ? 
- [ ]  Check the structure of my_message object  
- [ ]  Access the help (cursor + F1 on the function) : check in help window

See also [Help in R studio](https://swcarpentry.github.io/r-novice-gapminder/03-seeking-help.html)


```{r  echo=TRUE, eval=FALSE}
length(my_message)
nchar(my_message)

nb_char <- nchar(my_message)
nb_char + 10
nb_char * nchar(my_message)
```

- [ ]  we can results objects from cell to cell in the same notebook 
- [ ]  vector of length one VS number of characters of a string .... 
(be sure to always check if your results make sense according to what you expect !)

Bellow we show you a small introduction to: 
- types of objects in R
- character vectors 
- lists and sub-setting of list
- manipulations with functions that allows to transform objects
- several operations are possible one after another - hierarchy parentheses

```{r echo=TRUE, eval=FALSE}
strsplit(my_message, split = "")

split_test <- strsplit(my_message, split = "") 
split_test
typeof(split_test)

split_test[[1]]
split_test[[1]][1]
```

- transforming a string into a list of characters (types conversion)
- sub-setting and extracting elements from indexed objects
- reassignment variables - replacement in memory
- using arrow(s) to recall the last result(s) in console

```{r echo=TRUE, eval=FALSE}
unlist(split_test)
split_test <-unlist(split_test)

split_test
split_test[1]
typeof(split_test)
length(split_test)
```

Do not worry, if this goes fast. We will come back to that during the course. 

<mark><b>What you need to retain from here is: to have a have critical sense and check your results</b></mark>

- [ ] please check that you saved your notes and do all the required steps to push those
on github.

## Installing packages

Packages are a way to extend the functionality of R.
```{r install packages, echo=TRUE, eval=FALSE, class.source = "fold-show"}
# A comment
# Another way to get help on a function
?install.packages

# installing here package
install.packages("here", dependencies = TRUE)
```


Library is a function that allows you to load (into memory, and make it available 
to you) a package in your R session.

<u>The function here() gives the path of the project</u>
```{r eval=FALSE}
# loading the package
library(here)
here()
```
NB: You can also install packages using Rstudio (BUT its better to keep a trace 
of what you have installed)

You can call functions from packages that are not loaded to memory if they are 
installed on your system. This can be convenient if you only want to use one function.

Calling functions while specifying the package can be usefull also, if you have
loaded some packages that have functions with the same name. 
It is generally a good practice to do so (but takes time to do so .... ) 
<!-- recommends to do so when we are happy of what our code does  --> 


```{r eval=FALSE}
here::here()
```
## Packages and different ways to do the same thing

There are many packages in R, 
and there are usually many ways to do the same thing, 
some functions share also some similarities 

```{r eval=FALSE}
library(dplyr)

# both functions allow to have a look at the structure of your data
glimpse(my_message) 
dplyr::glimpse(my_message) 
str(my_message)
```


```{r eval=FALSE}
library(stringr)
# both functions allow to split a string
str_split_1(my_message, pattern = "")
unlist(strsplit(my_message, split = ""))
```
- [ ]  reading the help - imports  (glimpse vs pkg::glimpse)


Functions are objects. 
In packages, functions functions that do complex things, are often build using
several simpler functions. Here we show that there are several ways to obtain
the same results. 

```{r eval=FALSE}
my_strsplit1 <- function(char_var){
  temp <- strsplit(char_var, split = "")
  return(unlist(temp))
}

my_strsplit1(my_message)
```
Different way to write : (explain)
```{r eval=FALSE}
# return is factlatif if an oject is returned at creation
my_strsplit2 <- function(char_var){
  unlist(
    strsplit(char_var, split = "")
    )
}
my_strsplit2(my_message)

```
Pipes ... 
```{r eval=FALSE}
my_strsplit3 <- function(char_var){
  # R pipe  
  strsplit(char_var, split = "") |>
    unlist()
  # importance ()
}

my_strsplit3(my_message)
```
[magrittr](https://magrittr.tidyverse.org/) which is part of the tidyverse 
multiverse (a collection of packages that work well together) offers another type of pipe, which is the one that you will see most commonly used.


```{r eval=FALSE}
my_strsplit4 <- function(char_var){
  # R pipe  
  strsplit(char_var, split = "") %>%
    unlist
  # with %>% () can be omited (though not advised)
}

my_strsplit4(my_message)
```

<mark><b>What you need to retain from here is:</b></mark>

- there are different ways to do the 
same tings. R syntax is flexible and not always homogeneous. Do not learn a syntax, 
check in the help when in doubt </li>
- there are several ways to obtain the result you want. While some are prettier
or more efficient from other, the most important is that it does what you want it 
to do.


- [ ]   save, push your notes on github, and close your notes and project. Ask questions if you do not know what to answer to questions Rstudio might ask
